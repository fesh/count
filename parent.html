<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/count.css" rel="stylesheet" />

	</head>

	<body>
		<div class="mui-content" style="overflow: hidden;">
			<img src="images/saveBg.jpg" alt="" class="responsivImg" />
			<ul class="mui-table-view parent_list">
				<li class="mui-table-view-cell mui-collapse mui-active parent_list_li">
					<a class="mui-navigate-right" href="#">Item 1</a>
					<div class="mui-collapse-content">
						<div class="mui-input-row">父母呼唤及时回答 不慢吞吞很久才应答 <span class="mui-pull-right mui-badge mui-badge-inverted">1</span> </div>
					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse parent_list_li">
					<a class="mui-navigate-right" href="#">Item 2</a>
					<div class="mui-collapse-content">
						<!-- 第2个面板中的内容 -->
						<div class="mui-input-row">父母呼唤及时回答 不慢吞吞很久才应答 <span class="mui-pull-right mui-badge mui-badge-inverted">1</span> </div>
					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse parent_list_li">
					<a class="mui-navigate-right" href="#">Item 3</a>
					<div class="mui-collapse-content">
						<!-- 第3个面板中的内容 -->
						<div class="mui-input-row">父母呼唤及时回答 不慢吞吞很久才应答 <span class="mui-pull-right mui-badge mui-badge-inverted">1</span> </div>
					</div>
				</li>
			</ul>
			<div id="starAmount"></div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/bmob-min.js"></script>
		<script src="js/count.js"></script>
		<script>
			(function($, doc) {
				$.init({});
				$.plusReady(function() {
					if (plus.networkinfo.getCurrentType() == plus.networkinfo.CONNECTION_NONE) {
						mui.toast("当前网络不给力，无法连接云端数据库~");
					} else {
						Bmob.initialize("eabc522c19905225432088bca76c3c07", "f065625250b33e3447ce3cd8631c97ea");
					}
					$(".parent_list").on("tap", ".mui-input-row", function() {
						this.childNodes[1].innerText == 1 ? this.childNodes[1].innerText = 0 : this.childNodes[1].innerText = 1;
					});
					var parentObject = Bmob.Object.extend("parent");
					var parent = new parentObject();
					var parentId = "";
	
					var selectData = function(){
						var query = new Bmob.Query(parentObject);
						query.equalTo("createDate",new Date().Format("yyyy-MM-dd"));
						query.equalTo("userId",Bmob.User.current().id);
						query.first({
							success:function(result){
								parentId = result.id;
							},
							error:function(error){
								$.toast(error.message);
							}
						});
					};
	
					var insertData = function() {
						var starData = "{";
						var amount = 0;
						$(".mui-badge").each(function(index) {
							starData += index + ":" + this.innerText + ",";
							amount += parseInt(this.innerText);
						});
						starData += "114:" + amount + "}";
						$("#starAmount")[0].innerText = amount;
						parent.set("userId",Bmob.User.current().id);
						parent.set("starData",starData);
						parent.set("amount",amount);
						parent.save(parentId,{success:function(object){
							$.toast("更新成功！");
						},
						error:function(object,error){
							$.toast("更新失败，稍后重试！");
						}
						});
					}
					var starAmountButton = doc.getElementById("starAmount");
					starAmountButton.addEventListener('tap', function(event) {
						insertData();
					});
					selectData();
				});
			}(mui, document));
		</script>
	</body>

</html>